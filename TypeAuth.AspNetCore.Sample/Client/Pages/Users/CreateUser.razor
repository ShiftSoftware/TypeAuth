@page "/User/CreateUser"
@inject IUserService UserService
@inject NavigationManager Navigation

<h3>Create User</h3>

<EditForm Model="user" OnValidSubmit=Create>
    <DataAnnotationsValidator />

    <div class="mb-3">
        <label class="form-label">
            Username
            <InputText class="form-control" placeholder="Username" @bind-Value=user.Username />
        </label>
        <ValidationMessage For="()=> user.Username" />
    </div>

    <div class="mb-3">
        <label class="form-label">
            Password
            <InputText type="password" class="form-control" placeholder="Password" @bind-Value=user.Password />
        </label>
        <ValidationMessage For="()=> user.Password" />
    </div>

    @if (showError)
    {
        <p class="alert alert-danger">The operation was not succeeded</p>
    }

    <button type="submit" class="btn btn-primary">Create</button>
</EditForm>

@code {
    private RegisterUserDto user = new();
    private bool showError = false;

    private async Task Create(){
        showError = false;

        var createdUser = await UserService.CrateUserAsync(user);

        if (createdUser is not null)
            Navigation.NavigateTo("User");
            
        showError = true; 
    }
}
